<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Premier Predict - Matchday 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f5f7fa;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
    }
    .card {
      background: var(--card);
      max-width: 720px;
      margin: 0 auto;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    h1 {
      margin: 0 0 8px;
      text-align: center;
      font-weight: 600;
    }
    p.sub {
      margin: 0 0 24px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }
    .field {
      margin-bottom: 16px;
    }
    label.block {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: var(--muted);
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      outline: none;
      font-size: 16px;
    }
    .fixture {
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }
    .fixture:last-child { border-bottom: 0; }
    .fixture-title {
      font-weight: 600;
      margin-bottom: 8px;
    }
    .options {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .opt {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      font-size: 14px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
    }
    .error {
      color: #dc2626;
      font-size: 14px;
      margin-top: 8px;
      min-height: 20px;
    }
    button {
      background: var(--primary);
      color: white;
      width: 100%;
      border: 0;
      padding: 14px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s ease;
      margin-top: 8px;
    }
    button:hover { background: var(--primary-dark); }
    button:disabled { background: #9ca3af; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Premier League â€” Matchday 2</h1>
    <p class="sub">Pick the outcome for all 10 fixtures</p>

    <form id="lotteryForm" novalidate>
      <div class="field">
        <label for="phone" class="block">Phone Number</label>
        <input id="phone" type="text" placeholder="e.g. 08012345678" />
      </div>

      <div class="field">
        <label for="amount" class="block">Amount (â‚¦)</label>
        <input id="amount" type="number" placeholder="Enter stake amount" />
      </div>

      <div id="fixtures"></div>

      <div id="error" class="error"></div>

      <button id="submitBtn" type="submit">Submit Ticket</button>
    </form>
  </div>

  <script>
    const API_URL = "https://premierpredict.onrender.com/tickets";
    const PUBLIC_API_KEY = "pk_live_275047104ef6b1006ee0daf80f3507700cc18943";

    const fixtures = [
      "Nottingham Forest vs Bournemouth",
      "Liverpool vs Brentford",
      "Chelsea vs Wolves",
      "Man City vs Tottenham",
      "Fulham vs Brighton",
      "West Ham vs Arsenal",
      "Newcastle vs Aston Villa",
      "Everton vs Crystal Palace",
      "Man United vs Southampton",
      "Leicester vs Burnley"
    ];

    const fixturesDiv = document.getElementById("fixtures");

    // Render fixtures with neatly aligned radio options
    fixtures.forEach((match, i) => {
      const wrapper = document.createElement("div");
      wrapper.className = "fixture";
      wrapper.innerHTML = `
        <div class="fixture-title">${match}</div>
        <div class="options">
          <label class="opt"><input type="radio" name="fixture-${i}" value="Home"> Home</label>
          <label class="opt"><input type="radio" name="fixture-${i}" value="Draw"> Draw</label>
          <label class="opt"><input type="radio" name="fixture-${i}" value="Away"> Away</label>
        </div>
      `;
      fixturesDiv.appendChild(wrapper);
    });

    document.getElementById("lotteryForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const errorDiv = document.getElementById("error");
      const submitBtn = document.getElementById("submitBtn");
      errorDiv.textContent = "";

      const phone = document.getElementById("phone").value.trim();
      const amount = Number(document.getElementById("amount").value.trim());

      // Phone (Nigeria) validation
      const phoneRegex = /^(?:\+234|0)[789][01]\d{8}$/;
      if (!phoneRegex.test(phone)) {
        errorDiv.textContent = "Please enter a valid Nigerian phone number.";
        return;
      }

      if (!Number.isFinite(amount) || amount <= 0) {
        errorDiv.textContent = "Please enter a valid amount greater than 0.";
        return;
      }

      // Collect and validate selections (must be 10)
      const selections = {};
      for (let i = 0; i < fixtures.length; i++) {
        const choice = document.querySelector(`input[name="fixture-${i}"]:checked`);
        if (!choice) {
          errorDiv.textContent = "Please make a prediction for all 10 matches.";
          return;
        }
        selections[i] = choice.value;
      }

      // Submit
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-api-key": PUBLIC_API_KEY
          },
          body: JSON.stringify({ phone, amount, selections })
        });

        const data = await res.json();

        if (!res.ok || !data.success) {
          errorDiv.textContent = data.error || "Something went wrong. Please try again.";
        } else {
          alert(`ðŸŽ‰ Ticket created!\nTicket ID: ${data.ticket_id}\nAmount: â‚¦${data.amount}`);
          document.getElementById("lotteryForm").reset();
        }
      } catch (err) {
        console.error(err);
        errorDiv.textContent = "Network error. Please try again.";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Ticket";
      }
    });
  </script>
</body>
  </html>
