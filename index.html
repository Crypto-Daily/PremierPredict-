<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PremierPredict Lottery</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background: #fff;
      padding: 25px 35px;
      border-radius: 15px;
      box-shadow: 0px 8px 20px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 420px;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      color: #444;
    }

    input, button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    button {
      background: #4facfe;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #00c6fb;
    }

    .matches {
      margin-bottom: 15px;
    }

    .match {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }

    .match label {
      flex: 1;
    }

    .radio-group {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PremierPredict</h1>
    <form id="lotteryForm">
      <label for="phone">Phone Number</label>
      <input type="text" id="phone" name="phone" placeholder="Enter your phone number" required>

      <div class="matches" id="matches"></div>

      <button type="submit">Play Now - ₦100</button>
    </form>
  </div>

  <script>
    const fixtures = [
      "Nottingham Forest vs Bournemouth",
      "Liverpool vs Brentford",
      "Chelsea vs Wolves",
      "Man City vs Tottenham",
      "Fulham vs Brighton",
      "West Ham vs Arsenal",
      "Newcastle vs Aston Villa",
      "Everton vs Crystal Palace",
      "Man United vs Southampton",
      "Leicester vs Burnley"
    ];

    const matchesDiv = document.getElementById("matches");
    fixtures.forEach((match, index) => {
      matchesDiv.innerHTML += `
        <div class="match">
          <label>${match}</label>
          <div class="radio-group">
            <label><input type="radio" name="match${index}" value="Home" required> Home</label>
            <label><input type="radio" name="match${index}" value="Away"> Away</label>
            <label><input type="radio" name="match${index}" value="Draw"> Draw</label>
          </div>
        </div>
      `;
    });

    document.getElementById("lotteryForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const phone = document.getElementById("phone").value;
      const selections = {};

      fixtures.forEach((_, index) => {
        const selected = document.querySelector(`input[name="match${index}"]:checked`);
        selections[index] = selected ? selected.value : null;
      });

      const data = { phone, selections, amount: 100 };

      try {
        const response = await fetch("https://premierpredict.onrender.com/api/tickets", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        if (result.status === "success") {
          alert(`✅ Ticket created!\nID: ${result.ticket.ticket_id}\nReference: ${result.ticket.reference}`);
        } else {
          alert("❌ Error: " + result.message);
        }
      } catch (err) {
        alert("⚠️ Server error. Try again later.");
        console.error(err);
      }
    });
    
document.getElementById("lotteryForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const phone = document.getElementById("phone").value;
  const selections = {};
  document.querySelectorAll("input[type=radio]:checked").forEach((input, idx) => {
    selections[idx] = input.value;
  });

  try {
    const res = await fetch("https://premierpredict.onrender.com/api/pay", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ phone, selections }),
    });

    const data = await res.json();

    if (data.authorization_url) {
      // ✅ Redirect to Paystack payment page
      window.location.href = data.authorization_url;
    } else {
      alert("Payment failed: " + data.error);
    }
  } catch (err) {
    alert("Server error, please try again.");
  }
});
</script>
</body>
</html>
