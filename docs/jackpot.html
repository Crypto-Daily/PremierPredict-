<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jackpot - PremierPredict</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 2rem; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 2rem;
      border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .ticket, .match { border-bottom: 1px solid #ddd; padding: 1rem 0; }
    button { width: 100%; padding: 0.8rem; margin-top: 1rem; border: none;
      border-radius: 4px; font-weight: bold; cursor: pointer; background: #007bff; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üéØ Jackpot</h2>
    <div id="jackpot-info">Loading jackpot...</div>
    <div id="matchesContainer"></div>
    <p><b>Bet Amount:</b> ‚Ç¶100 (fixed)</p>
    <button id="placeBetBtn">Place Bet</button>

    <h3 style="margin-top:2rem;">üìú My Tickets</h3>
    <div id="ticketsContainer">Loading tickets...</div>
  </div>

  <script>
    const API_URL = "http://localhost:5000/api"; // adjust if hosted

    function getToken() {
      return localStorage.getItem("token");
    }

    async function loadJackpot() {
      const res = await fetch(`${API_URL}/jackpot`, {
        headers: { Authorization: `Bearer ${getToken()}` }
      });
      const data = await res.json();
      const infoDiv = document.getElementById("jackpot-info");
      if (!data.matches) {
        infoDiv.innerHTML = "<p>No active jackpot.</p>";
        return;
      }
      infoDiv.innerHTML = `<p><b>${data.name}</b> ‚Äî Pool: ‚Ç¶${data.prize_pool_kobo/100}</p>`;
      document.getElementById("matchesContainer").innerHTML = data.matches.map(m => `
        <div class="match">
          <p><b>${m.home_team}</b> vs <b>${m.away_team}</b> (${new Date(m.match_time).toLocaleString()})</p>
          <label><input type="radio" name="m_${m.match_id}" value="home_win"> Home</label>
          <label><input type="radio" name="m_${m.match_id}" value="draw"> Draw</label>
          <label><input type="radio" name="m_${m.match_id}" value="away_win"> Away</label>
        </div>
      `).join("");
    }

    async function placeBet() {
      const selections = [];
      document.querySelectorAll(".match").forEach(div => {
        const radios = div.querySelectorAll("input[type=radio]");
        let sel = null;
        radios.forEach(r => { if (r.checked) sel = r.value; });
        if (sel) {
          const matchId = Number(radios[0].name.split("_")[1]);
          selections.push({ match_id: matchId, prediction: sel });
        }
      });
      if (selections.length !== 10) return alert("‚ö† Pick all 10 matches");

      const res = await fetch(`${API_URL}/jackpot/bet`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: `Bearer ${getToken()}` },
        body: JSON.stringify({ selections })
      });
      const data = await res.json();
      alert(data.message || "Bet placed!");
      loadTickets();
    }

    async function loadTickets() {
      const res = await fetch(`${API_URL}/jackpot/tickets`, {
        headers: { Authorization: `Bearer ${getToken()}` }
      });
      const data = await res.json();
      const container = document.getElementById("ticketsContainer");
      if (!data.tickets || data.tickets.length === 0) {
        container.innerHTML = "<p>No tickets found.</p>";
        return;
      }
      container.innerHTML = data.tickets.map(t => `
        <div class="ticket">
          <p><b>Ticket #${t.id}</b> ‚Äî ‚Ç¶${t.amount_kobo/100} ‚Äî Ref: ${t.reference}</p>
          <ul>
            ${t.selections.map(s => `
              <li>Match ${s.match_id}: ${s.selection} ‚Üí ${s.result || "pending"}
              ${s.is_correct === true ? "‚úÖ" : s.is_correct === false ? "‚ùå" : ""}</li>
            `).join("")}
          </ul>
        </div>
      `).join("");
    }

    document.getElementById("placeBetBtn").addEventListener("click", placeBet);
    loadJackpot();
    loadTickets();
  </script>
</body>
</html>
