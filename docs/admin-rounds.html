<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin | Jackpot Rounds</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-2xl font-bold mb-4">🎯 Manage Jackpot Rounds</h1>

  <!-- Create Round -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Create New Round</h2>
    <input id="roundName" class="border p-2 rounded w-64" placeholder="Round Name (e.g. Round 8)" />
    <button onclick="createRound()" class="bg-blue-600 text-white px-4 py-2 rounded ml-2">Create</button>
  </div>

  <!-- Add Match -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Add Match</h2>
    <input id="roundId" class="border p-2 rounded w-20" placeholder="Round ID" />
    <input id="homeTeam" class="border p-2 rounded w-40 ml-2" placeholder="Home Team" />
    <input id="awayTeam" class="border p-2 rounded w-40 ml-2" placeholder="Away Team" />
    <input id="matchTime" type="datetime-local" class="border p-2 rounded ml-2" />
    <button onclick="addMatch()" class="bg-green-600 text-white px-4 py-2 rounded ml-2">Add</button>
  </div>

  <!-- Update Result -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Update Match Result</h2>
    <input id="matchId" class="border p-2 rounded w-20" placeholder="Match ID" />
    <select id="result" class="border p-2 rounded w-24 ml-2">
      <option value="">Select</option>
      <option value="H">Home Win</option>
      <option value="D">Draw</option>
      <option value="A">Away Win</option>
    </select>
    <button onclick="updateResult()" class="bg-yellow-600 text-white px-4 py-2 rounded ml-2">Update</button>
  </div>

  <button onclick="loadRounds()" class="bg-gray-800 text-white px-4 py-2 rounded mb-4">Refresh Rounds</button>
  <div id="roundsList" class="space-y-4"></div>

  <script>
    const API = "/api/admin";

    async function createRound() {
      const name = document.getElementById("roundName").value;
      const res = await fetch(`${API}/rounds`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });
      alert("Round created!");
      loadRounds();
    }

    async function addMatch() {
      const round_id = +document.getElementById("roundId").value;
      const home_team = document.getElementById("homeTeam").value;
      const away_team = document.getElementById("awayTeam").value;
      const match_time = document.getElementById("matchTime").value;
      await fetch(`${API}/matches`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ round_id, home_team, away_team, match_time })
      });
      alert("Match added!");
      loadRounds();
    }

    async function updateResult() {
      const id = +document.getElementById("matchId").value;
      const result = document.getElementById("result").value;
      await fetch(`${API}/matches/${id}/result`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ result })
      });
      alert("Result updated!");
      loadRounds();
    }

    async function loadRounds() {
      const res = await fetch(`${API}/rounds`);
      const data = await res.json();
      const div = document.getElementById("roundsList");
      div.innerHTML = data.map(r => `
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-bold">${r.round_name} (ID: ${r.round_id}) ${r.is_active ? '🟢 Active' : ''}</h3>
          <ul class="mt-2">
            ${r.matches?.map(m => `
              <li class="border-b py-1">
                ${m.home_team} vs ${m.away_team} — ${m.result ?? '⏳ Pending'}
              </li>`).join("")}
          </ul>
        </div>
      `).join("");
    }

    loadRounds();
  </script>
</body>
      </html>
